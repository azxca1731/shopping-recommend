# Shopping Recommend

<img src="./running.gif">

### 개요

본 프로젝트는 2019 핵데이 섬머에 출전한 주제로서 `검색 엔진을 이용하여 채팅 어플리케이션 내 쇼핑 상품 검색, 추천 기능 구현`이 주제였습니다.

### 기능

1. 빅데이터 저장소와 검색 엔진 내에 상품 데이터 최적화(상품 데이터 1억 건, 응답 시간 500ms 미만)
2. 웹소켓 기술을 활용한 Subscription
3. 과거 대화 내용 조회
4. 세션을 통한 유저별 서비스

### 사용방법

1. 플러스 아이콘을 누른다
2. 나오는 창에 자신이 원하는 상품명을 친다
3. 그렇게 하면 원하는 상품이 나온다
4. `추천`이라고 칠 시 현재 검색했던 항목들 중에 가장 많이 검색된 카테고리를 기반으로 추천을 해준다.(검색을 했어야함)
5. 검색을 마치고 싶다면 엑스 아이콘을 눌러 최소화 시킨다.

### 개발 스택

1. 백엔드 (노드, graphql-yoga(express기반))
2. 프론트엔드 (리액트, 아폴로)
3. 디비 (몽고(대화목록), 레디스(세션))
4. 엘라스틱 서치

#### 그래프큐엘 요가를 선택한 이유

1. 빠른 시간내에 graphql서버를 구축 할 수 있습니다.
2. Typedefinition을 정의하는 schema.graphql이 있어 가독성이 좋습니다.
3. PubSub과 같은 Subscription기능에 대하여 어느정도 구축이 되있습니다.

#### 아폴로를 선택하게 된 이유

1. 아폴로는 cache를 사용하여 redux와 같은 상태관리를 해줍니다.
2. 웹소켓 프로토콜과 http프로토콜의 적절한 분배가 가능합니다.
3. 요청(axios와 같은)과 컴포넌트를 결합한 형태로 만들 수 있습니다.

#### 세션을 사용한 이유

본 프로젝트는 대화목록을 저장해야합니다. 고로 맞는 사람에게 맞는 대화목록이 저장되야한다고 생각했습니다. 이에 무조건 로그인과 같은 유저 식별작업이 필요하나 쇼핑이라는 특성상 비로그인 유저가 많다고 생각을 했습니다.
그래서 쿠키를 사용한 사용자 인식을 생각해냈고 안정성을 위하여 세션을 사용했습니다.
또한 만약 본 프로젝트에서 로그인을 넣을시에 그동안 있었던 세션 데이터를 옮겨 넣을때에도 좋다고 생각했습니다.

#### 레디스를 쓴 이유

웹소켓은 프로토콜 특성상 처음 연결할 때를 제외하고는 쿠키를 받을 수 없습니다.
그래서 현재 쓰고 있는 express-session은 미들웨어로서 req에 session이라는 것을 달아줍니다.
하지만 웹소켓은 이렇게 express-session을 거치지 않습니다. 첫 핸드쉐이킹때 쿠키를 받고 파싱한후 해당 세션에 맞는 데이터를 인자로 넘겨주기 위해 사용했습니다. 또한 웹서버가 꺼져도 세션이 유지가 됩니다.

#### 엘라스틱 서치를 쓴 이유

1. 해쉬구조상 빠른 서치가 가능합니다.
2. 현재는 아니지만 애널라이저를 달아 토크나이즈를 달아 특정 텀에 대해 특정 가중치를 두어 검색에 정확도를 높일 수 있습니다.
3. 레스트풀 API를 지원하여 간단하게 가능 합니다.

#### NGINX를 사용한 이유

1. 프론트와 백엔드를 완전히 분리 시켜놓을 수 있습니다
2. 리버스 프록시로 보안을 높여줍니다.
